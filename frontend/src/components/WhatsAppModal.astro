---
// Componente modal para selecci√≥n de √°rea de WhatsApp
// Props: defaultArea puede ser 'servicios', 'motos', 'repuestos' o null para mostrar todas las opciones

interface Props {
  defaultArea?: 'servicios' | 'motos' | 'repuestos' | null;
}

const { defaultArea = null } = Astro.props;

// N√∫meros de WhatsApp (configurar en variables de entorno)
// Repuestos: +56992405120
// Servicios y Motos Usadas: +56997504742
const WHATSAPP_SERVICIOS_MOTOS = import.meta.env.PUBLIC_WHATSAPP_SERVICIOS_MOTOS || '56997504742';
const WHATSAPP_REPUESTOS = import.meta.env.PUBLIC_WHATSAPP_REPUESTOS || '56992405120';

// Mensajes predefinidos por √°rea
const mensajes = {
  servicios: 'Hola, me interesa conocer m√°s sobre los servicios t√©cnicos.',
  motos: 'Hola, me interesa informaci√≥n sobre motos usadas.',
  repuestos: 'Hola, me interesa consultar sobre repuestos y accesorios.'
};

// Funci√≥n para obtener URL de WhatsApp seg√∫n √°rea
function getWhatsAppUrl(area: 'servicios' | 'motos' | 'repuestos'): string {
  const numero = area === 'repuestos' ? WHATSAPP_REPUESTOS : WHATSAPP_SERVICIOS_MOTOS;
  const mensaje = mensajes[area];
  return `https://wa.me/${numero}?text=${encodeURIComponent(mensaje)}`;
}
---

<div id="whatsapp-modal" class="fixed inset-0 bg-black/70 z-50 hidden items-center justify-center backdrop-blur-sm p-4">
  <div class="bg-white dark:bg-gradient-to-b dark:from-gray-900 dark:to-gray-950 border-2 border-gray-300 dark:border-primary rounded-xl p-6 md:p-8 w-full max-w-md shadow-2xl">
    <div class="flex items-center justify-between mb-6 border-b-2 border-gray-300 dark:border-primary pb-4">
      <h2 class="text-xl md:text-2xl font-bold text-gray-900 dark:text-ktm-text">Selecciona un √°rea</h2>
      <button id="close-whatsapp-modal" class="text-gray-600 dark:text-ktm-text/80 hover:text-gray-900 dark:hover:text-ktm-text text-2xl font-bold">‚úï</button>
    </div>
    
    <div class="space-y-4">
      {defaultArea === null || defaultArea === 'servicios' ? (
        <a
          href={getWhatsAppUrl('servicios')}
          target="_blank"
          rel="noopener noreferrer"
          class="block w-full px-6 py-4 bg-ktm-accent hover:bg-ktm-accent-600 text-ktm-light-text dark:text-ktm-text font-bold rounded-lg transition-all text-center"
        >
          <div class="text-lg mb-1">üîß √Årea de Servicios</div>
          <div class="text-sm opacity-90">Mantenciones y reparaciones</div>
        </a>
      ) : null}
      
      {defaultArea === null || defaultArea === 'motos' ? (
        <a
          href={getWhatsAppUrl('motos')}
          target="_blank"
          rel="noopener noreferrer"
          class="block w-full px-6 py-4 bg-ktm-accent hover:bg-ktm-accent-600 text-ktm-light-text dark:text-ktm-text font-bold rounded-lg transition-all text-center"
        >
          <div class="text-lg mb-1">üèçÔ∏è √Årea de Venta de Motos</div>
          <div class="text-sm opacity-90">Motos usadas disponibles</div>
        </a>
      ) : null}
      
      {defaultArea === null || defaultArea === 'repuestos' ? (
        <a
          href={getWhatsAppUrl('repuestos')}
          target="_blank"
          rel="noopener noreferrer"
          class="block w-full px-6 py-4 bg-ktm-accent hover:bg-ktm-accent-600 text-ktm-light-text dark:text-ktm-text font-bold rounded-lg transition-all text-center"
        >
          <div class="text-lg mb-1">üî© √Årea de Repuestos</div>
          <div class="text-sm opacity-90">Repuestos y accesorios</div>
        </a>
      ) : null}
    </div>
  </div>
</div>

<script>
  function openWhatsAppModal() {
    const modal = document.getElementById('whatsapp-modal');
    if (modal) {
      modal.classList.remove('hidden');
      modal.classList.add('flex');
    }
  }
  
  function closeWhatsAppModal() {
    const modal = document.getElementById('whatsapp-modal');
    if (modal) {
      modal.classList.add('hidden');
      modal.classList.remove('flex');
    }
  }
  
  // Cerrar al hacer click fuera del modal
  const modal = document.getElementById('whatsapp-modal');
  if (modal) {
    modal.addEventListener('click', (e) => {
      if (e.target === e.currentTarget) {
        closeWhatsAppModal();
      }
    });
  }
  
  const closeBtn = document.getElementById('close-whatsapp-modal');
  if (closeBtn) {
    closeBtn.addEventListener('click', closeWhatsAppModal);
  }
  
  // Exponer funci√≥n globalmente para que otros scripts puedan usarla
  (window as any).openWhatsAppModal = openWhatsAppModal;
  (window as any).closeWhatsAppModal = closeWhatsAppModal;
</script>

